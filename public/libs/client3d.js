/*
 * client3d.js - v0.3.1
 * Compiled Mon Feb 25 2019 17:20:11 GMT+0800 (GMT+08:00)
 * Copyright (c) 2019 www.hisense.com & www.hightopo.com
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.hteditor3d=e()}(this,function(){"use strict";function t(t){return/^scenes/.test(t)}function e(t){return/^models/.test(t)}function i(t){return/^symbols/.test(t)}function o(t){return/^assets/.test(t)}function n(t){return ht.Default.getImageMap()[t]?(delete ht.Default.getImageMap()[t],!0):ht.Default.getCompTypeMap()[t]?(delete ht.Default.getCompTypeMap()[t],!0):(void 0!==ht.Default.getShape3dModel(t)&&ht.Default.setShape3dModel(t,void 0),!1)}function r(t,e,i,o){var n=new ht.Tab;return n.setName(e),n.setView(i),t.getTabModel().add(n),o&&t.getTabModel().sm().ss(n),n}function s(t,e,i){var o=new FileReader;o.onloadend=function(t){e(t.target.result)},i?o.readAsDataURL(t):o.readAsText(t)}function a(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?decodeURIComponent(i[2]):null}function d(t,e){e.forEach(function(e){t.push(u(e))})}function h(t){var e=void 0,i=void 0,o=void 0,n=void 0,r=void 0,s=void 0,a=[],h=[];t.forEach(function(t){d(a,t.getPoints());var l=t.getSegments();if(l)l=l.toArray();else{l=[1];for(var c=1,p=t.getPoints().size();c<p;c++)l.push(2)}h.push.apply(h,l),e||(e=t.dm(),i=t.getThickness(),o=t.getElevation(),n=t.getTall(),r=u(t.getStyleMap()),s=u(t.getAnchor3d())),t.removeFromDataModel()});var l=new ht.Shape;l.setPoints(a),l.setSegments(h),l.setThickness(i),l.setElevation(o),l.setTall(n),l.setAnchor3d(s),l.s(r),e.add(l)}function l(t){var e=t.dm(),i=t.getSegments();if(i){var o=[],n=t.getPoints(),r=void 0,s=void 0,a=0;i.forEach(function(t){switch(t){case 1:r=[t],s=[u(n.get(a++))],o.push({segments:r,points:s});break;case 2:r.push(t),s.push(u(n.get(a++)));break;case 3:r.push(t),s.push(u(n.get(a++))),s.push(u(n.get(a++)));break;case 4:r.push(t),s.push(u(n.get(a++))),s.push(u(n.get(a++))),s.push(u(n.get(a++)));break;case 5:r.push(t)}});var d=t.getThickness(),h=t.getElevation(),l=t.getTall(),c=u(t.getStyleMap()),p=u(t.getAnchor3d());o.forEach(function(t){var i=new ht.Shape;i.setPoints(t.points),i.setSegments(t.segments),i.setThickness(d),i.setElevation(h),i.setTall(l),i.setAnchor3d(p),i.s(c),e.add(i)}),t.removeFromDataModel()}}var c={createTablePane:function(){var t=new ht.widget.TablePane;return t.getView().style.border=hteditor.config.color_line+" solid 1px",t},removeItem:function(t,e){if(t){var i=t.indexOf(e);i>=0&&t.splice(i,1)}},alert:function(t,e,i,o){var n=[{label:hteditor.getString("editor.ok"),action:function(){r.hide(),i&&i()}}],r=new ht.widget.Dialog({title:t||" ",contentPadding:20,width:o||300,draggable:!0,content:"<p>"+e+"</p>",buttons:n});r.show()},config:window.hteditor_config||{}},p=function(){},u=ht.Default.clone;ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("hxeditor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("hxeditor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.sphere",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("hxeditor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("hxeditor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("hxeditor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("hxeditor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("hxeditor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]});var g=(function(){function t(t){this.value=t}function e(e){function i(t,e){return new Promise(function(i,n){var a={key:t,arg:e,resolve:i,reject:n,next:null};s?s=s.next=a:(r=s=a,o(t,e))})}function o(i,r){try{var s=e[i](r),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){o("next",t)},function(t){o("throw",t)}):n(s.done?"return":"normal",s.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}r=r.next,r?o(r.key,r.arg):s=null}var r,s;this._invoke=i,"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),f=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),m=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},v=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},b=function(){function t(e,i){var o=this;g(this,t),this.handler=e,this.editor=i,this.cookie=0,this.callbacks={},this.cmds={};var n=hteditor.config.host||window.location.hostname,r=hteditor.config.port||window.location.port,s="http://"+n+":"+r;this.socket=io.connect(s),this.socket.on("connect",function(){o.handler({type:"connected",message:s})}),this.socket.on("disconnect",function(){o.handler({type:"disconnected",message:s})}),this.socket.on("fileChanged",function(t){o.handler({type:"fileChanged",path:t.path,event:t.event})}),this.socket.on("operationDone",function(t,e){o.handleRespone(t,e)}),this.socket.on("download",function(t){o.handler({type:"download",path:t})})}return t.prototype.request=function(t,e,i){var o=++this.cookie;this.callbacks[o]=i,this.cmds[o]=t;var n=this.editor.sid;this.socket.emit(t,o,e,n?{sid:n}:null);var r=t;e&&(ht.Default.isString(e)?r=t+": "+e:e.path&&(r=t+": "+e.path)),this.handler({type:"request",message:r,cmd:t,data:e})},t.prototype.handleRespone=function(t,e){var i=this.callbacks[t],o=this.cmds[t];delete this.callbacks[t],delete this.cmds[t],i&&i(e),this.handler({type:"response",message:o,cmd:o,data:e})},t}(),w=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"scenes"))}return m(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list),this.addExportItem(e)},e}(hteditor.Explorer),I=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"models"))}return m(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),D=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"symbols"))}return m(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),S=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"assets"))}return m(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),C=hteditor.getString,P=function(t){function e(i){g(this,e);var o=v(this,t.call(this));o.editor=i,o.editor.menus.push(o);var n=[{label:C("editor.newsceneview"),action:function(){o.editor.newScene()}},{label:C("editor.newmodel"),items:[{label:C("editor.obj"),action:function(){o.editor.newOBJModel()}}]}];return o.setItems(n),o}return m(e,t),e}(ht.widget.ContextMenu),T=function(t){function e(i){g(this,e);var o=v(this,t.call(this,i.gv));return o.editor=i,o}return m(e,t),e.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},e.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},e.prototype.getDataAt=function(t){return this.gv.getDataAt(t)},e.prototype.getNodeAt=function(t){var e=this.getDataAt(t);return e instanceof ht.Node?e:null},e.prototype.setUp=function(){t.prototype.setUp.call(this),this.sm.cs()},e.prototype.drawCanvas=function(t){},e.prototype.drawRect=function(t,e,i,o){e=this.toRect(e),o&&(t.fillStyle=o),i&&(t.strokeStyle=i),t.lineWidth=1,t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.stroke(),o&&t.fill(),i&&t.stroke()},e.prototype.drawPoint=function(t,e,i,o,n){e=this.toPoint(e),n&&(t.fillStyle=n),o&&(t.strokeStyle=o),t.lineWidth=1,t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI,!0),n&&t.fill(),o&&t.stroke()},e.prototype.drawPoints=function(t,e,i,o,n){for(var r=0;r<e.length;r++)this.drawPoint(t,e[r],i,o,n)},e.prototype.drawLine=function(t,e,i,o){e=this.toPoint(e),i=this.toPoint(i),t.lineWidth=1,t.strokeStyle=o,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.stroke()},e.prototype.toRect=function(t){var e=this.zoom;return{x:t.x*e+this.tx,y:t.y*e+this.ty,width:t.width*e,height:t.height*e}},e.prototype.toPoint=function(t){return{x:t.x*this.zoom+this.tx,y:t.y*this.zoom+this.ty}},e.prototype.addData=function(t){this.editor.dm.add(t),this.editor.sm.ss(t),this.editor.gv.setFocus()},e.prototype.remove=function(t){this.dm.remove(t)},e.prototype.lp=function(t){return this.gv.lp(t)},f(e,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),e}(ht.graph.Interactor),L=function(t){function e(i,o,n){g(this,e);var r=v(this,t.call(this,i));return r.createFunc=o,r.points=[],r.segments=[],r.nextPoint=null,r.fill=n,r}return m(e,t),e.prototype.tearDown=function(){t.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},e.prototype.handleEsc=function(t){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},e.prototype.createShape=function(){if(this.points.length>1){var t=this.createFunc(this.points,this.segments);this.addData(t)}this.editor.setInteractionState("edit"),this.editor.pointsEditingMode=!0},e.prototype.handle_mousedown=function(t){this.handle_touchstart(t)},e.prototype.handle_touchstart=function(t){if(ht.Default.preventDefault(t),ht.Default.isLeftButton(t))if(this.gv.setFocus(t),ht.Default.isDoubleClick(t))this.createShape();else{var e=this.lp(t);if(this.points.length){var i=this.points[this.points.length-1];if(Math.abs(i.x-e.x)<.01&&Math.abs(i.y-e.y)<.01)return}this.points.push(e),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(t),this.editor.rulerView.validateCanvas()}},e.prototype.handle_mousemove=function(t){this.nextPoint&&(this.nextPoint=this.lp(t),this.editor.rulerView.validateCanvas())},e.prototype.drawCanvas=function(t){t.beginPath();for(var e=0,i=void 0,o=void 0,n=void 0,r=0;r<this.segments.length;r++){var s=this.segments[r];1===s?(i=this.toPoint(this.points[e++]),t.moveTo(i.x,i.y)):2===s?(i=this.toPoint(this.points[e++]),t.lineTo(i.x,i.y)):3===s?(i=this.toPoint(this.points[e++]),o=this.toPoint(this.points[e++]),t.quadraticCurveTo(i.x,i.y,o.x,o.y)):4===s?(i=this.toPoint(this.points[e++]),o=this.toPoint(this.points[e++]),n=this.toPoint(this.points[e++]),t.bezierCurveTo(i.x,po,y,o.x,o.y,n.x,n.y)):5===s&&t.closePath()}if(this.nextPoint){var a=this.toPoint(this.nextPoint);t.lineTo(a.x,a.y)}t.strokeStyle=hteditor.config.color_data_border,t.lineWidth=1,t.stroke(),this.fill&&(t.fillStyle=hteditor.config.color_transparent,t.fill()),this.drawPoints(t,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},e}(T),x=function(t){function e(i,o){g(this,e);var n=v(this,t.call(this,i));return n.createFunc=o,n}return m(e,t),e.prototype.tearDown=function(){t.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},e.prototype.handle_mousedown=function(t){this.handle_touchstart(t)},e.prototype.handle_touchstart=function(t){ht.Default.preventDefault(t),ht.Default.isLeftButton(t)&&(this.gv.setFocus(t),this.p1=this.lp(t),this.startDragging(t))},e.prototype.handleWindowMouseMove=function(t){this.handleWindowTouchMove(t)},e.prototype.handleWindowMouseUp=function(t){this.handleWindowTouchEnd(t)},e.prototype.handleWindowTouchMove=function(t){if(ht.Default.preventDefault(t),this.p1){this.p2=this.lp(t);var e=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(e);else{if(!e.width||!e.height)return;this.beginTransaction(),this.createNode(e,!1)}}},e.prototype.handleWindowTouchEnd=function(t){ht.Default.preventDefault(t),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.setInteractionState("edit")},e.prototype.createNode=function(t,e){this.node=this.createFunc(t,e),this.node.s3(50,50,50),e?this.node.setPosition(t.x+t.width/2,t.y+t.height/2):this.node.setRect(t),this.addData(this.node)},e.prototype.drawCanvas=function(t){this.node&&this.drawRect(t,this.node.getRect(),hteditor.config.color_data_border)},e}(T),R=hteditor.getString,k=function(t){function e(i){g(this,e);var o=v(this,t.call(this));return o.editor=i,o.initMenu(),o.initItems(),o.enableToolTip(),o}return m(e,t),e.prototype.initMenu=function(){var t=this.editor.mainMenu=new P(this.editor),e=function(e){t.isShowing()&&!t.getView().contains(e.target)&&t.hide()};window.addEventListener("touchstart",e,!1),window.addEventListener("mousedown",e,!1)},e.prototype.initItems=function(){var t=[];t.push(this.createMenuItem()),t.push(this.createEditItem()),t.push(this.createCubeItem()),t.push(this.createCylinderItem()),t.push(this.createSphereItem()),t.push(this.createWallItem()),t.push(this.createDoorWindowItem()),t.push(this.createFloorItem()),t.push(this.createPipelineItem()),this.setItems(t)},e.prototype.createMenuItem=function(){var t=this,e=hteditor.createItem("menu",R("editor.menu"),"editor.menu");return e.action=function(e,i,o){t.editor.mainMenu.isShowing()||(t.editor.mainMenu.showOnView(t,4,20),o.preventDefault(),o.stopPropagation())},e},e.prototype.createEditItem=function(){var t=this,e=function(){return"edit"===t.editor.getInteractionState()},i=hteditor.createItem("edit",R("editor.edit"),"editor.edit",e);return i.action=function(){t.editor.setInteractionState("edit")},i},e.prototype.createWallItem=function(){var t=this,e=function(){return"wall"===t.editor.getInteractionState()},i=hteditor.createItem("wall",R("editor.wall"),"hxeditor.wall",e);return i.action=function(){var e=new L(t.editor,function(t,e){var i=new ht.Shape;return i.setTall(280),i.setThickness(14),i.setElevation(i.getTall()/2),i.setPoints(t),i.setSegments(e),i.s({"all.color":"#DDDDDD","shape.background":null,"shape.border.width":i.getThickness(),"shape.border.color":"#DDDDDD"}),i});t.editor.setInteractionState("wall",e)},i},e.prototype.createDoorWindowItem=function(){var t=this,e=function(){return"doowWindow"===t.editor.getInteractionState()},i=hteditor.createItem("doorWindow",R("editor.doorwindow"),"editor.doorWindow",e);return i.action=function(){var e=new x(t.editor,function(){return new ht.DoorWindow},!0);t.editor.setInteractionState("doowWindow",e)},i},e.prototype.createFloorItem=function(){var t=this,e=function(){return"floor"===t.editor.getInteractionState()},i=hteditor.createItem("floor",R("editor.floor"),"hxeditor.floor",e);return i.action=function(){var e=new L(t.editor,function(t,e){var i=new ht.Shape;return i.setTall(10),i.setThickness(-1),i.setElevation(-i.getTall()/2),i.setPoints(t),i.setSegments(e),i.s({"shape3d.color":"#EEEEEE","shape3d.top.color":"#EEEEEE","shape3d.bottom.color":"#EEEEEE","shape.background":"#EEEEEE"}),i.setAnchor3d(.5,0,.5),i},!0);t.editor.setInteractionState("floor",e)},i},e.prototype.createPipelineItem=function(){var t=this,e=function(){return"pipeline"===t.editor.getInteractionState()},i=hteditor.createItem("pipeline",R("editor.pipeline"),"hxeditor.pipeline",e);return i.action=function(){var e=new L(t.editor,function(t,e){var i=new ht.Polyline;return i.setPoints(t),i.setSegments(e),i.setThickness(10),i.s({shape3d:"cylinder","shape3d.color":"#BFBFBF","shape3d.top.color":"#BFBFBF","shape3d.bottom.color":"#BFBFBF","shape.background":null,"shape.border.width":i.getThickness(),"shape.border.color":"#BFBFBF"}),i});t.editor.setInteractionState("pipeline",e)},i},e.prototype.createCubeItem=function(){var t=this,e=function(){return"cube"===t.editor.getInteractionState()},i=hteditor.createItem("cube",R("editor.cube"),"hxeditor.cube",e);return i.action=function(){var e=new x(t.editor,function(){var t=new ht.Node;return t.s({"all.color":"#DDDDDD"}),t.setAnchor3d(.5,0,.5),t},!0);t.editor.setInteractionState("cube",e)},i},e.prototype.createCylinderItem=function(){var t=this,e=function(){return"cylinder"===t.editor.getInteractionState()},i=hteditor.createItem("cylinder",R("editor.cylinder"),"hxeditor.cylinder",e);return i.action=function(){var e=new x(t.editor,function(){var t=new ht.Node;return t.s({shape3d:"cylinder","shape3d.color":"#DDDDDD"}),t.setAnchor3d(.5,0,.5),t},!0);t.editor.setInteractionState("cylinder",e)},i},e.prototype.createSphereItem=function(){var t=this,e=function(){return"sphere"===t.editor.getInteractionState()},i=hteditor.createItem("cube",R("editor.sphere"),"hxeditor.sphere",e);return i.action=function(){var e=new x(t.editor,function(){var t=new ht.Node;return t.s({shape3d:"sphere","shape3d.color":"#DDDDDD"}),t.setAnchor3d(.5,0,.5),t},!0);t.editor.setInteractionState("sphere",e)},i},e}(ht.widget.Toolbar),E=hteditor.getString,_=function(t){function e(i){g(this,e);var o=v(this,t.call(this));return o.editor=i,o.initItems(),o.enableToolTip(),o.setStickToRight(!0),o.editor.gv.addPropertyChangeListener(o.handlePropertyChange,o),o.updateZoomLabel(),o}return m(e,t),e.prototype.handlePropertyChange=function(t){"zoom"===t.property&&this.updateZoomLabel()},e.prototype.updateZoomLabel=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},e.prototype.initItems=function(){var t=this,e=void 0,i=[];e=hteditor.createItem("save",E("editor.save"),"editor.save"),e.action=function(){t.editor.save()},i.push(e),e=hteditor.createItem("reload",E("editor.reload"),"editor.reload"),e.action=function(){t.editor.reload()},i.push(e),i.push({separator:!0}),e=hteditor.createItem("grid",E("editor.showaxis"),"editor.axis",function(){return!t.editor.scene.isEditHelperDisabled()}),e.action=function(){t.editor.scene.setEditHelperDisabled(!t.editor.scene.isEditHelperDisabled())},i.push(e),e=hteditor.createItem("grid",E("editor.showgrid"),"editor.grid",function(){return t.editor.gridVisible}),e.action=function(){t.editor.toggleGridEnabled()},i.push(e),e=hteditor.createItem("preview",E("editor.preview"),"editor.preview"),e.action=function(){t.editor.preview()},i.push(e),i.push({separator:!0}),i.push(this.createZoomItem()),e=hteditor.createItem("zoomToFit",E("editor.zoomtofit"),"editor.zoomtofit"),e.action=function(){t.editor.zoomToFit()},i.push(e),i.push({separator:!0}),e=hteditor.createItem("toggleLeft",E("editor.toggleleft"),"editor.toggleleft"),e.action=function(){t.editor.toggleLeft()},i.push(e),e=hteditor.createItem("toggleRight",E("editor.toggleright"),"editor.toggleright"),e.action=function(){t.editor.toggleRight()},i.push(e),this.setItems(i)},e.prototype.createZoomItem=function(){var t=this,e=this.label=ht.Default.createDiv(!0);e.style.font=this.getLabelFont(),e.style.color=this.getLabelColor(),e.style.cursor="ew-resize",e.style.width="40px",e.style.height=ht.Default.widgetRowHeight+"px",e.style.lineHeight=ht.Default.widgetRowHeight+"px",e.style.whiteSpace="nowrap",e.style.textAlign="center";var i=function(e){e.preventDefault();var i=t.editor.gv;ht.Default.isDoubleClick(e)&&i.zoomReset();var o=i.getZoom(),n=ht.Default.getClientPoint(e).x,r=function(t){t.preventDefault();var e=ht.Default.getClientPoint(t).x-n;i.setZoom(o*(1+.005*e))};window.addEventListener("mousemove",r,!1),window.addEventListener("touchmove",r,!1);var s=function(t){t.preventDefault(),window.removeEventListener("mousemove",r,!1),window.removeEventListener("touchmove",r,!1),window.removeEventListener("mouseup",s,!1),window.removeEventListener("touchend",s,!1)};window.addEventListener("mouseup",s,!1),window.addEventListener("touchend",s,!1)};return e.addEventListener("mousedown",i,!1),e.addEventListener("touchstart",i,!1),{id:"zoom",unfocusable:!0,element:e}},e}(ht.widget.Toolbar),M=function(t){function e(i){g(this,e);var o=v(this,t.call(this,i.dm));return o.editor=i,o.setEditable(!0),o.topDiv=ht.Default.createDiv(),o}return m(e,t),e.prototype.handleDelete=function(){this.removeSelection()},e.prototype.getBrightness=function(){return null},e.prototype.isDroppable=function(t,e){return e.view===this.editor.models.list||(e.view===this.editor.symbols.list||e.view===this.editor.assets.list)},e.prototype.positionDragImage=function(t){if(this.dragImage){var e=hteditor.config.dragImageSize,i=ht.Default.getPagePoint(t);this.dragImage.style.left=i.x-e/2+"px",this.dragImage.style.top=i.y-e/2+"px"}},e.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},e.prototype.handleCrossDrag=function(t,e,i){var o=this,n=i.view,r=n.draggingData;if("enter"===e){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&r&&("model"===r.fileType||"symbol"===r.fileType||"image"===r.fileType)&&ht.Default.getImage(r.getImage())!==ht.Default.getImage("editor.unknown")){var s=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(r.getImage(),s,s,"centerUniform",r,i.view,null,ht.Default.devicePixelRatio),this.positionDragImage(t),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===e||"cancel"===e?(ht.Default.removeHTML(this.topDiv),this.removeDragImage()):"over"===e?this.positionDragImage(t):"drop"===e&&(ht.Default.removeHTML(this.topDiv),r&&(this.removeDragImage(),this.sm().cs(),n.handleDropToEditView?n.handleDropToEditView(this,r,this.getHitPosition(t),t):n.isSelected(r)?n.sm().toSelection().each(function(e){o.insert(e,t)}):this.insert(r,t)))},e.prototype.insert=function(t,e){var i=new ht.Node;"model"===t.fileType?i.s({shape3d:t.url}):"symbol"!==t.fileType&&"image"!==t.fileType||(i.s({shape3d:"billboard","shape3d.image":t.url,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),i.setImage(t.url)),i.setAnchor3d(.5,0,.5),i.p3(this.getHitPosition(e)),i.s("wf.visible","selected"),this.dm().add(i),this.sm().as(i)},e.prototype.toImage=function(t){var e=c.config.imageSize||400,i=this.getWidth(),o=this.getHeight(),n=Math.max(i,o),r=e/n;return i=Math.floor(i*r),o=Math.floor(o*r),this.toCanvas(t,i,o).toDataURL("image/png",1)},e}(ht.graph3d.Graph3dView),B={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},V=function(){function t(e){var i=this;g(this,t),this.graphView=e,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(t){"validate"===t.kind&&i.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){i.iv()}),this.dm.sm().addSelectionChangeListener(function(t){i.iv()}),this.dm.addDataPropertyChangeListener(function(t){i.handleDataPropertyChanged(t)}),this.dm.addPropertyChangeListener(function(t){i.handleDataModelPropertyChanged(t)}),this.dm.layout=function(t){i._autoLayout||(i._autoLayout=new ht.layout.AutoLayout(i.graphView)),i._autoLayout.layout(t,function(){i.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(t){t.keep=!0})}return t.prototype.handleDataPropertyChanged=function(t){B[t.property]&&this.iv()},t.prototype.handleDataModelPropertyChanged=function(t){this.validateCanvas()},t.prototype.onPropertyChanged=function(t){this.iv()},t.prototype.addData=function(t){this.dm.add(t),this.dm.sm().ss(t),this.graphView.setFocus()},t.prototype.validateCanvas=function(){var t=this.graphView._topCanvas;if(t){var e=hteditor.initContext(t);e.clearRect(0,0,t.clientWidth,t.clientHeight),this.graphView.getInteractors().each(function(t){t.drawCanvas&&t.drawCanvas(e)}),e.restore()}},t.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},t.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},t.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},t.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},f(t,[{key:"dm",get:function(){return this.graphView.dm()}}]),t}();hteditor.msClass(V,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var F=function(t){function e(i){g(this,e);var o=v(this,t.call(this,i.dm));return o.editor=i,o._topCanvas=ht.Default.createCanvas(),o._topDiv=ht.Default.createDiv(),o._view.insertBefore(o._topCanvas,o._scrollBarDiv),o._view.insertBefore(o._topDiv,o._scrollBarDiv),o.mi(function(t){"prepareMove"!==t.kind&&"prepareEdit"!==t.kind||!t.event.altKey||(o.editor.copy(),o.editor.paste(!0),o.validate())}),o}return m(e,t),e.prototype.initMenu=function(){var t=this,e=[];this.menu=new ht.widget.ContextMenu(e),e.push({id:"bringToFront",label:hteditor.getString("editor.bringtofront"),action:function(){t.editor.bringToFront()},visible:function(){return!!t.editor.ld}}),e.push({id:"bringForward",label:hteditor.getString("editor.bringforward"),action:function(){t.editor.bringForward()},visible:function(){return!!t.editor.ld}}),e.push({id:"sendBackward",label:hteditor.getString("editor.sendbackward"),action:function(){t.editor.sendBackward()},visible:function(){return!!t.editor.ld}}),e.push({id:"sendToBack",label:hteditor.getString("editor.sendtoback"),action:function(){t.editor.sendToBack()},visible:function(){return!!t.editor.ld}}),e.push({separator:!0,visible:function(){return!!t.editor.ld}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},e.prototype.getUnionNodeRect=function(t){var e=this,i=void 0;return t=t._as||t,t.forEach(function(t){t instanceof ht.Node&&(i=ht.Default.unionRect(i,e.getNodeRect(t)))}),i},e.prototype.getImage=function(t){var e=t.s("shape3d");if(e){var i=ht.Default.getShape3dModel(e);if(i&&i.json&&i.json.image)return i.json.image;if("sphere"===e||"cylinder"===e)return"hxeditor.sphere.image"}var o=t.getImage();return o&&"node_image"!==o?o:t.s("shape3d.image")?t.s("shape3d.image"):"hxeditor.cube.image"},e.prototype.getSelectWidth=function(t){return!this.isEditable(t)||t instanceof ht.Edge?t.s("select.width"):0},e.prototype.isDroppable=function(t,e){return e.view===this.editor.models.list||(e.view===this.editor.symbols.list||e.view===this.editor.assets.list)},e.prototype.positionDragImage=function(t){if(this.dragImage){var e=hteditor.config.dragImageSize,i=ht.Default.getPagePoint(t);this.dragImage.style.left=i.x-e/2+"px",this.dragImage.style.top=i.y-e/2+"px"}},e.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},e.prototype.handleCrossDrag=function(t,e,i){
var o=this,n=i.view,r=n.draggingData;if("enter"===e){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&r&&("model"===r.fileType||"symbol"===r.fileType||"image"===r.fileType)&&ht.Default.getImage(r.getImage())!==ht.Default.getImage("editor.unknown")){var s=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(r.getImage(),s,s,"centerUniform",r,i.view,null,ht.Default.devicePixelRatio),this.positionDragImage(t),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===e||"cancel"===e?(this._topDiv.style.border="",this.removeDragImage()):"over"===e?this.positionDragImage(t):"drop"===e&&(this._topDiv.style.border="",r&&(this.removeDragImage(),this.sm().cs(),n.handleDropToEditView?n.handleDropToEditView(this,r,this.lp(t),t):n.isSelected(r)?n.sm().toSelection().each(function(e){o.insert(e,t)}):this.insert(r,t)))},e.prototype.insert=function(t,e){var i=this.lp(e);if("model"===t.fileType){var o=new ht.Node;o.s({shape3d:t.url}),o.setAnchor3d(.5,0,.5),o.setPosition(i),this.dm().add(o),this.sm().as(o)}else if("symbol"===t.fileType||"image"===t.fileType){var n=new ht.Node;n.s({shape3d:"billboard","shape3d.image":t.url,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),n.setAnchor3d(.5,0,.5),n.p(i),n.setImage(t.url),this.dm().add(n),this.sm().as(n)}},e}(ht.graph.GraphView),N={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(t,e){if(t instanceof ht.Node){var i=t.s("shape3d");if(ht.Default.isString(i)&&hteditor.isJSON(i))return null}return hteditor.config.color_dark}},name:{func:function(t,e){if(t instanceof ht.Shape)return t.getThickness()>0?"hxeditor.wall":"hxeditor.floor";if(t instanceof ht.Node){var i=t.s("shape3d");if(i){if(ht.Default.isString(i)&&hteditor.isJSON(i))return i.substr(0,i.length-4)+"png";if("sphere"===i)return"hxeditor.sphere";if("cylinder"===i)return"hxeditor.cylinder"}return"hxeditor.cube"}return t.getIcon()}},rect:[0,0,20,16]}]},z=hteditor.getString,O={box:"editor.box",sphere:"editor.sphere",cone:"editor.cone",torus:"editor.torus",cylinder:"editor.cylinder",star:"editor.star",rect:"editor.rect",roundRect:"editor.roundrect",triangle:"editor.triangle",rightTriangle:"editor.righttriangle",parallelogram:"editor.parallelogram",trapezoid:"editor.trapezoid"},H=function(t){function e(i){g(this,e);var o=v(this,t.call(this,i,i.dm));return o.initMenu(),o}return m(e,t),e.prototype.handleDelete=function(){this.removeSelection()},e.prototype.onDataDoubleClicked=function(t,e){e.altKey?this.editor.gv.fitData(t,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(t,!0),this.editor.scene.flyTo(t,{animation:!0}))},e.prototype.getLabel=function(e){var i=t.prototype.getLabel.call(this,e);if(!i){var o=e.s("shape3d");e instanceof ht.Shape?i=z("cylinder"===o?"editor.pipeline":e.getThickness()>0?"editor.wall":"editor.floor"):e instanceof ht.Node&&((i=z(O[o]))||(i=hteditor.isJSON(o)?hteditor.fileNameToDisplayName(o):o)),i||(i=z("editor.cube"))}return i||""},e.prototype.getIcon=function(t){return N},e.prototype._endDrag=function(t,e){var i=this,o=e.type,n=e.parent,r=e.refData;if(this.isSelected(this.draggingData)){var s=this.getTopRowOrderSelection();"down"===o&&s.reverse(),s.each(function(t){i._dropData(t,o,n,r)})}else this._dropData(this.draggingData,o,n,r),this.sm().ss(this.draggingData);n&&this.expand(n)},e.prototype._dropData=function(t,e,i,o){if(t.setParent(i),"down"===e||"up"===e){var n=i?i.getChildren():this.dm().getRoots(),r=n.indexOf(o);"down"===e&&r++,n.indexOf(t)<r&&r--,this.dm().moveTo(t,r)}else i||this.dm().moveToBottom(t)},e.prototype.isEditable=function(t){return!0},e.prototype.rename=function(t,e){t.setDisplayName(e)},e.prototype.initMenu=function(){var t=this,e=function(){for(var e=t.editor.sm.getSelection(),i=0,o=e.length;i<o;i++)if(!(e.get(i)instanceof ht.Shape))return!1;return!0};this.menu=new ht.widget.ContextMenu;var i=[{id:"combined",label:z("editor.combinedshapes"),action:function(){t.editor.beginTransaction(),h(t.editor.sm.getSelection().toArray()),t.editor.endTransaction()},visible:function(){return t.editable&&t.editor.sm.size()>1&&e()}},{id:"splitShape",label:z("editor.splitshape"),action:function(){t.editor.beginTransaction(),l(t.editor.ld),t.editor.endTransaction()},visible:function(){return t.editable&&1===t.editor.sm.size()&&t.editor.ld instanceof ht.Shape}}];this.menu.setItems(i),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},e}(hteditor.DNDTree),A=hteditor.getString,W=function(t){function e(i){g(this,e);var o=v(this,t.call(this));return o.editor=i,o.initForm(),o.visible=!1,o.oopsImageJSON=ht.Default.getImage("editor.oops"),o.oopsImage=ht.Default.toCanvas(o.oopsImageJSON,o.oopsImageJSON.width,o.oopsImageJSON.height,"fill",null,null,null,ht.Default.devicePixelRatio).toDataURL(),o}return m(e,t),e.prototype.initForm=function(){var t=this;this.addRow([{id:"content",textArea:{}}],[.1],.1),this.addRow([{id:"url",textField:{editable:!1}},{id:"edit",button:{onClicked:function(){t.editing=!t.editing}}},{id:"commit",button:{label:A("editor.commit"),onClicked:function(){t.editor.reset(!0),t.editor.dm.disableHistoryManager(),t.editor.deserialize(t.content),t.editing=!1,t.editor.dm.enableHistoryManager(),t.editor.dm.clearHistoryManager()}}}],[.1,50,50]),this.getView().style.background=hteditor.config.color_pane,this.textArea=this.getViewById("content").getElement(),this.editing=!1},e.prototype.updateContentLater=function(){var t=this;this.visible&&!this.editing&&(this._updateContentLater||(this._updateContentLater=!0,setTimeout(function(){t.updateContent()},100)))},e.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},e.prototype.updateURL=function(){this.v("url",this.editor.url||"")},f(e,[{key:"editing",get:function(){return this._editing},set:function(t){this._editing!==t&&(this._editing=t,this.getViewById("edit").setLabel(A(t?"editor.cancel":"editor.edit")),this.getViewById("commit").setDisabled(!t),this.getViewById("content").setEditable(t),t||this.updateContentLater())}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,t?this.updateContent():this.editing||(this.content=""))}},{key:"content",get:function(){return this.v("content")},set:function(t){if(t&&t.length>hteditor.config.maxStringLength){t="Oops, tooooo long!",this.setDisabled(!0,this.oopsImage);var e=this.oopsImageJSON.width,i=this.oopsImageJSON.height;this.getDisabledDiv().style.backgroundSize=e+"px "+i+"px"}else this.setDisabled(!1);this.v("content",t)}}]),e}(ht.widget.FormPane),j=hteditor.getString,q=function(t){function e(i){g(this,e);var o=v(this,t.call(this));o.editor=i,o.buttons={};var n=[];n.push(o.createItem("cluster",j("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),n.push(o.createItem("distributeHorizontal",j("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),n.push(o.createItem("distributeVertical",j("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),n.push(o.createItem("alignLeft",j("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),n.push(o.createItem("alignHorizontal",j("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),n.push(o.createItem("alignRight",j("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),n.push(o.createItem("alignTop",j("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),n.push(o.createItem("alignVertical",j("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),n.push(o.createItem("alignBottom",j("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var r=.1,s=[r,r,r,r,r,r,r,r,r];return o.addRow(n,s),o.updateItems(),o.editor.sm.ms(function(){return o.updateItems()}),o}return m(e,t),e.prototype.createItem=function(t,e,i){var o=this;i.forEach(function(t){t.borderCap="round"}),i[0].borderColor=i[0].borderColor||hteditor.config.color_dark,i[1].borderColor=i[1].borderColor||hteditor.config.color_select;var n={width:16,height:16,fitSize:!0,comps:i};return this.buttons[t]=hteditor.createButton(null,e,n,function(){o[t]()})},e.prototype.updateItems=function(){var t=[];this.editor.sm.each(function(e){e instanceof ht.Node&&t.push(e)}),t.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):t.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},e.prototype.getUnionRect=function(t){return this.editor.gv?this.editor.gv.getUnionNodeRect(t):null},e.prototype.isSelected=function(t){return this.editor.sm.contains(t)},e.prototype.hasSelectedGroupParent=function(t){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},e.prototype.hasSelectedHost=function(t){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},e.prototype.cluster=function(){var t=this.selection;if(t.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var e=void 0,i=void 0;t.forEach(function(t){void 0===e?e=i=t.getElevation():(e>t.getElevation()&&(e=t.getElevation()),i<t.getElevation()&&(i=t.getElevation()))}),t.sort(function(t,e){return t.getElevation()-e.getElevation()});for(var o=(i-e)/(t.length-1),n=1;n<t.length-1;n++)t[n].setElevation(e+n*o);this.editor.endTransaction()}},e.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},e.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},e.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},e.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},e.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},e.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},e.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},e.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},f(e,[{key:"selection",get:function(){var t=this,e=[];return this.editor.sm.each(function(i){i instanceof ht.Node&&(t.hasSelectedGroupParent(i.getParent())||t.hasSelectedHost(i)||e.push(i))}),e}}]),e}(ht.widget.FormPane),U=function(t){function e(i,o){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];g(this,e);var r=v(this,t.call(this,i,o,o,n));return r.setHPadding(8),r.setVPadding(4),r.addUpdateHandler(function(){r.initDataBindings()}),r}return m(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addCustomProperties()},e.prototype.addTitle=function(t,e){var i=this._oldTitle;this.editor.fireEvent("titleCreating",{oldTitle:i,title:t,inspector:this});var o=[],n=hteditor.getString("editor."+t.toLowerCase(),!0)||hteditor.getString(t);o.push({element:n,font:hteditor.config.boldFont}),e=e||{},e.title=t,e.background=hteditor.config.color_pane_dark;var r=this.addRow(o,[.1],null,e);return this._oldTitle=t,this.editor.fireEvent("titleCreated",{oldTitle:i,title:t,inspector:this}),r},e.prototype.addOneRow=function(t,e,i){for(var o=[this.indent,.1],n=2,r=t.length;n<r;n++)o.push(20);var s=this.addRow(t,o,e?this.getRowHeight()*e:null,i);return s.index=this.getRows().length-1,s},e.prototype.addDBRow=function(t,e,i,o,n){var r=this,s=void 0;if(c.config.dataBindings&&(!c.config.dataBindings.filter||c.config.dataBindings.filter(e,i))){var a=function(){c.config.dataBindings.onButtonClicked(r.data,e,i)},d=e+":"+i,h=this.addButton(t,null,d,null,a,!0);this.updateHandlers.push(function(){if(!t.hidden&&r.data){var o=c.config.isDataBound(r.data,e,i);h.setIcon(o?"editor.bind.state":"editor.unbind.state")}})}return s=this.addOneRow(t,n,o),s.keys={name:i,displayName:this.toDisplayName(t),accessType:e},s},e.prototype.initDataBindings=function(){var t=this,e=this._dataBindingRowInfos;e&&e.length>0&&(this.removeRows(e),this._dataBindingRowInfos=null);var i=this._dataBindingHandlers;i&&i.length>0&&(i.forEach(function(e){t.removeUpdateHandler(e)}),this._dataBindingHandlers=null);var o=this.data;if(o){var n=[o.s("all.image"),o.s("top.image"),o.s("bottom.image"),o.s("left.image"),o.s("right.image"),o.s("front.image"),o.s("back.image"),o.s("shape3d.image"),o.s("shape3d.top.image"),o.s("shape3d.bottom.image"),o.s("shape3d.from.image"),o.s("shape3d.to.image")],r=[];if(n.forEach(function(t){t&&r.push(ht.Default.getImage(t))}),0!==r.length){for(var s=[],a=!1,d=0,h=r.length;d<h;d++){var l=r[d];if(!l){a=!0;break}l.dataBindings&&s.push.apply(s,l.dataBindings)}if(a){var c=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];c.apply(ht.Default,i),t.initDataBindings(),ht.Default.handleImageLoaded=c})}if(0!==s.length){var p=this.updateHandlers.length;e=[this.addTitle(hteditor.getString("DataBindings"))];var u={};s.forEach(function(i){var o=i.attr;if(!u[o]){u[o]=1;var n=t.addDataBind(i);e.push(t.addDBRow(n,"a",o))}}),this._dataBindingRowInfos=e,this._dataBindingHandlers=this.updateHandlers.slice(p),this._dataBindingHandlers.forEach(function(t){t()})}}}},e.prototype.addDataBind=function(t){var e=[],i=t.attr,o=hteditor.config.valueTypes[t.valueType];if(!o)return this.editor.fireEvent("error",{message:"Wrong value type:"+t.valueType}),!1;var n=hteditor.getString(t.name)||i,r=function(t){return t.a(i)},s=function(t,e){return t.a(i,e)};return"int"===o.type||"number"===o.type?o.angle?this.addLabelRotation(e,n,r,s,o.min,o.max,o.step):this.addLabelRange(e,n,r,s,o.min,o.max,o.step,o.type):"color"===o.type?this.addLabelColor(e,n,r,s):"boolean"===o.type?this.addLabelCheckBox(e,n,r,s):"enum"===o.type?this.addLabelComboBox(e,n,r,s,o.values,o.labels,o.icons):"multiline"===o.type?this.addLabelMultiline(e,n,r,s):"font"===o.type?this.addLabelFont(e,n,r,s):"image"===o.type?this.addLabelImage(e,n,r,s):"url"===o.type?this.addLabelURL(e,n,r,s):"colorArray"===o.type?this.addLabelArray(e,n,r,s,"color"):"numberArray"===o.type?this.addLabelArray(e,n,r,s,"number"):"stringArray"===o.type?this.addLabelArray(e,n,r,s,"string"):"objectArray"===o.type?this.addLabelArray(e,n,r,s,"object"):"function"===o.type?this.addLabelFunction(e,n,r,s,i):"object"===o.type?this.addLabelObject(e,n,r,s,i):this.addLabelInput(e,n,r,s),e},e.prototype.addLabelData=function(t,e,i,o){var n=this,r=this.addLabelInput(t,e,function(t){var e=i(t);return e?e.toLabel()||e.getClassName():""}),s=r.getElement();r.isDroppable=function(t,e){return e.view.draggingData&&n.dataModel===e.view.draggingData.getDataModel()},r.handleCrossDrag=function(t,e,i){"enter"===e?s.style.border="solid "+c.config.color_select_dark+" 2px":"exit"===e||"cancel"===e?s.style.border="":"over"===e||"drop"===e&&(s.style.border="",n.setValue(o,i.view.draggingData),r.setFocus())},s.onkeydown=function(t){ht.Default.isDelete(t)&&n.setValue(o,null)};var a=new ht.widget.Image;a.drawImage=function(t,e,i,o,r,s){var d=a.data,h=n.editor.list;d&&h&&h.dm().contains(d)&&(e=h.getIcon(d))&&drawStretchImage(t,ht.Default.getImage(e),"centerUniform",i,o,r,s,d,h)},this.updateHandlers.push(function(){if(!t.hidden){var e=a.data;a.data=n.getValue(i),a.fp("data",e,a.data)}}),t.push(a)},e.prototype.addLabelComboBoxURL=function(t,e,i,o,n,r,s,a){var d=this,h=this.addLabelComboBox(t,e,i,o,n,r,s);if(o){h.setEditable(!0);var l=h.getView();h.isDroppable=a||function(t,e){return!!e.view.draggingData},h.handleCrossDrag=function(t,e,i){if("enter"===e)l.style.border="solid "+c.config.color_select_dark+" 2px";else if("exit"===e||"cancel"===e)l.style.border="";else if("over"===e);else if("drop"===e){l.style.border="";var n=l.value=i.view.draggingData.uuid;h.setFocus(),d.setValue(o,n)}}}return h},e.prototype.addImage=function(t,e,i,o,n){var r=this,s=new ht.widget.Image;s.vectorDataBindingDisabled=!0;var a=o||function(t){var e=ht.Default.getImage(t);return e&&e.snapshotURL?e.snapshotURL:t};this.updateHandlers.push(function(){if(!t.hidden){var i=r.getValue(e);s.rawIcon=i,s.setIcon(a(i))}});var d=s.getView();d.style.cursor="pointer";var h=function(t){t.preventDefault(),n&&!n(s)||(ht.Default.isDoubleClick(t)?r.editor.open(s.rawIcon):r.editor.selectFileNode(s.rawIcon))};return d.addEventListener("mousedown",h,!1),d.addEventListener("touchstart",h,!1),t.push(s),s},f(e,[{key:"type",set:function(t){this._type=t},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}},{key:"indent",get:function(){return hteditor.config.indent}},{key:"indent2",get:function(){return hteditor.config.indent2}}]),e}(hteditor.Inspector),G=ht.Default.preventDefault,J=ht.Default.isLeftButton,X=ht.Default.getTouchCount,Z=ht.Default.isCtrlDown,Y=ht.Default.isShiftDown,K=ht.Default.getClientPoint,$=function(t){var e=t.touches[0],i=t.touches[1],o=e.clientX,n=e.clientY,r=i.clientX,s=i.clientY;return Math.sqrt((o-r)*(o-r)+(n-s)*(n-s))},Q=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},tt="undefined"!=typeof Float32Array?Float32Array:Array,et=function(){return Q(new tt(16))},it=Math.abs,ot=Math.sqrt,nt=function(t,e,i,o){var n,r,s,a,d,h,l,c,p,u,g=e[0],f=e[1],m=e[2],v=o[0],b=o[1],y=o[2],w=i[0],I=i[1],D=i[2];return it(g-w)<1e-6&&it(f-I)<1e-6&&it(m-D)<1e-6?Q(t):(l=g-w,c=f-I,p=m-D,u=1/ot(l*l+c*c+p*p),l*=u,c*=u,p*=u,n=b*p-y*c,r=y*l-v*p,s=v*c-b*l,u=ot(n*n+r*r+s*s),u?(u=1/u,n*=u,r*=u,s*=u):(n=0,r=0,s=0),a=c*s-p*r,d=p*n-l*s,h=l*r-c*n,u=ot(a*a+d*d+h*h),u?(u=1/u,a*=u,d*=u,h*=u):(a=0,d=0,h=0),t[0]=n,t[1]=a,t[2]=l,t[3]=0,t[4]=r,t[5]=d,t[6]=c,t[7]=0,t[8]=s,t[9]=h,t[10]=p,t[11]=0,t[12]=-(n*g+r*f+s*m),t[13]=-(a*g+d*f+h*m),t[14]=-(l*g+c*f+p*m),t[15]=1,t)},rt=function(t){function e(i){return g(this,e),v(this,t.call(this,i))}return m(e,t),e.prototype.handle_contextmenu=function(t){G(t)},e.prototype.handle_mousewheel=function(t){this.gv.handleScroll(t,t.wheelDelta/40)},e.prototype.handle_DOMMouseScroll=function(t){2===t.axis&&this.gv.handleScroll(t,-t.detail)},e.prototype.handle_keydown=function(t){this.gv.handleKeyDown(t)},e.prototype.handle_mousedown=function(t){this.handle_touchstart(t)},e.prototype.handle_touchstart=function(t){G(t);var e=this,i=e.gv,o=J(t),n=i.getDataInfoAt(t),r=n?n.data:null,s=n?n.part:null,a=i.sm(),d=X(t),h=1===d;i.setFocus(t)&&(e.state=null,e.pendingCS=null,r?Z(t)?a.co(r)?a.rs(r):a.as(r):a.co(r)||a.ss(r):o&&(e.pendingCS=K(t)),e.state||(o&&h&&!r?e.state="pan":o&&h&&r instanceof ht.Node&&i.isSelected(r)?i.isMovable(r)&&(e.state="move",e.p3=r.p3(),e.movedata=r):ht.Default.isTouchable&&(d>2?e.state="pan":2===d&&(e.dist=$(t),e.state="pinch"))),e.point=i.lp(t),ht.Default.startDragging(e,t),ht.Default.isDoubleClick(t)?i.handleDoubleClick(t,r,s):i.handleClick(t,r,s))},e.prototype.handle_mouseup=function(t){this.handle_touchend(t)},e.prototype.handle_touchend=function(t){var e=this.pendingCS;e&&(ht.Default.getDistance(e,K(t))<=1&&this.gv.sm().cs(),this.pendingCS=null)},e.prototype.handleWindowMouseMove=function(t){this.handleWindowTouchMove(t)},e.prototype.handleWindowTouchMove=function(t){var e=this,i=e.gv,o=e.state,n=e.point,r=i.dm(),s=i.lp(t),a=s.x-n.x,d=s.y-n.y,h=i.getWidth(),l=i.getHeight();if(h&&l){if("move"===o){i._moving||r.beginTransaction(),i.fi({kind:i._moving?"betweenMove":"beginMove",event:t}),i._moving=1;var c=e.p3,p=i.getPositionInfo(c),u=nt(et(),i._eye,i._center,i._up);a=a/h*p.width,d=-1*d/l*p.height;var g=[u[0]*a,u[4]*a,u[8]*a],f=[u[1]*d,u[5]*d,u[9]*d],m=g[0]+f[0],v=g[1]+f[1],b=g[2]+f[2],y=[c[0]+m,c[1]+v,c[2]+b];i.moveSelection(m,v,b),e.p3=y}else if("pinch"===o&&2===X(t)){i.fi({kind:i._pinching?"betweenPinch":"beginPinch",event:t}),i._pinching=1;var w=$(t);i.handlePinch(w,e.dist),e.dist=w}else("pan"===o||Y(t))&&e.pan(t,a,d);e.point=s}},e.prototype.pan=function(t,e,i){var o=this.gv;if(o.isPannable()){var n=o.getWidth(),r=o.getHeight();if(!n||!r)return;var s=o.getCenterInfo(),a=e/n*s.width,d=-1*i/r*s.height;o.fi({kind:o._panning?"betweenPan":"beginPan",event:t}),o._panning=1,o.pan(-a,-d)}},e.prototype.handleWindowMouseUp=function(t){this.handleWindowTouchEnd(t)},e.prototype.handleWindowTouchEnd=function(t){var e=this,i=e.gv,o=i.dm();i._moving&&(delete i._moving,i.fi({kind:"endMove",event:t}),i.onMoveEnded(),o.endTransaction()),i._panning&&(delete i._panning,i.fi({kind:"endPan",event:t}),i.onPanEnded()),i._pinching&&(delete i._pinching,i.fi({kind:"endPinch",event:t}),i.onPinchEnded()),e.dist=e.point=e.state=e.p3=e.movedata=e.pendingCS=null},e}(ht.graph3d.Interactor),st=hteditor.getString,at=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"scene",!0))}return m(e,t),e.prototype.initForm=function(){var e=this;t.prototype.initForm.call(this);var i=void 0;this.addTitle(st("editor.titlescenes")),i=[],this.addLabelInput(i,st("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(i,[this.indent,.1]),i=[],i.push(st("editor.camera")),this.addButton(i,null,st("editor.reset"),"editor.resetsize.state",function(){e.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(i,"X",function(t){return parseFloat(e.editor.scene.getEye()[0])},function(t,i){var o=e.editor.scene.getEye();e.editor.scene.setEye(i,o[1],o[2])},"int",1),this.addLabelInput(i,"Y",function(t){return parseFloat(e.editor.scene.getEye()[1])},function(t,i){var o=e.editor.scene.getEye();e.editor.scene.setEye(o[0],i,o[2])},"int",1),this.addLabelInput(i,"Z",function(t){return parseFloat(e.editor.scene.getEye()[2])},function(t,i){var o=e.editor.scene.getEye();e.editor.scene.setEye(o[0],o[1],i)},"int",1),this.addRow(i,[this.indent-40-8,20,20,.1,20,.1,20,.1]),i=[],i.push(st("editor.center")),this.addButton(i,null,st("editor.reset"),"editor.resetsize.state",function(){e.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(i,"X",function(t){return parseFloat(e.editor.scene.getCenter()[0])},function(t,i){var o=e.editor.scene.getCenter();e.editor.scene.setCenter(i,o[1],o[2])},"int",1),this.addLabelInput(i,"Y",function(t){return parseFloat(e.editor.scene.getCenter()[1])},function(t,i){var o=e.editor.scene.getCenter();e.editor.scene.setCenter(o[0],i,o[2])},"int",1),this.addLabelInput(i,"Z",function(t){return parseFloat(e.editor.scene.getCenter()[2])},function(t,i){var o=e.editor.scene.getCenter();e.editor.scene.setCenter(o[0],o[1],i)},"int",1),this.addRow(i,[this.indent-40-8,20,20,.1,20,.1,20,.1]),i=[],this.addLabelRange(i,st("editor.near"),function(){return e.editor.scene.getNear()},function(t,i){e.editor.scene.setNear(i)},1,void 0,1,"int"),this.addLabelRange(i,st("editor.far"),function(){return e.editor.scene.getFar()},function(t,i){e.editor.scene.setFar(i)},0,void 0,100,"int"),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelColor(i,st("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(i,[this.indent,.1]),i=[],this.addLabelColor(i,st("editor.gridcolor"),function(t){var i=e.editor.scene.getGridColor();return i instanceof Array?"rgba("+Math.floor(255*i[0])+","+Math.floor(255*i[1])+","+Math.floor(255*i[2])+","+i[3]+")":e.editor.scene.getGridColor()},function(t,i){e.editor.scene.setGridColor(i)}),this.addRow(i,[this.indent,.1]),i=[],this.addLabelRange(i,st("editor.gridsize"),function(t){return e.editor.scene.getGridSize()},function(t,i){e.editor.scene.setGridSize(i)},0,void 0,1,"int"),this.addLabelRange(i,st("editor.gridgap"),function(t){return e.editor.scene.getGridGap()},function(t,i){e.editor.scene.setGridGap(i),e.editor.gv.getEditInteractor().setStyle("gridBlockSize",i)},1,void 0,1,"int"),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelImage(i,st("editor.envmapimage"),function(t){return t.getEnvmap()},function(t,e){return t.setEnvmap(e)}),this.addRow(i,[this.indent,.1,20]);var o=this.editor.scene,n=this.editor.scene.getHighlightHelper(),r=hteditor.config.valueTypes.HighlightEnum;i=[],this.addLabelComboBox(i,st("editor.highlight"),function(){return n.mode},function(t,e){n.mode=e},r.values,r.labels),this.addRow(i,[this.indent,.1]);var s=[],a=o.getPostProcessingModule("Bloom"),d=void 0,h=function(){d!==a.enable&&(a.enable?s.forEach(function(t,i){t.index=e.getRows().indexOf(l)+i+1,e.addRow(t.items,t.widths,t.height,t)}):e.removeRows(s),d=a.enable)};i=[],this.addLabelCheckBox(i,st("editor.bloom"),function(){return a.enable},function(t,i){o.enablePostProcessing("Bloom",i),o.iv(),e.updateProperties()});var l=this.addOneRow(i);i=[],this.addLabelRange(i,st("editor.bloomstrength"),function(){return a.strength},function(t,i){a.strength=i,o.iv(),e.updateProperties()},0,void 0,.01,"number"),s.push(this.addOneRow(i)),i=[],this.addLabelRange(i,st("editor.bloomradius"),function(){return a.radius},function(t,i){a.radius=i,o.iv(),e.updateProperties()},0,void 0,.01,"number"),s.push(this.addOneRow(i)),i=[],this.addLabelRange(i,st("editor.bloomthreshold"),function(){return a.threshold},function(t,i){a.threshold=i,o.iv(),e.updateProperties()},0,1,.01,"number"),s.push(this.addOneRow(i)),i=[];var c=["json","dm","gv"];this.addLabelFunction(i,st("editor.onpredeserialize"),function(t){return t.a("onPreDeserialize")},function(t,e){t.a("onPreDeserialize",e)},"onPreDeserialize",c),this.addOneRow(i),i=[],c=["json","dm","gv","datas"],this.addLabelFunction(i,st("editor.onpostdeserialize"),function(t){return t.a("onPostDeserialize")},function(t,e){t.a("onPostDeserialize",e)},"onPostDeserialize",c),this.addOneRow(i);var p=o.getMoveMode,u=function(){return"xyz"},g=new ht.Math.Vector3,f=new ht.Math.Vector3,m=new ht.Math.Vector3,v=function(t){if(t){g.fromArray(o.getCenter()),f.fromArray(o.getEye()),f.sub(g);var e=[0,1,0];"right"===t?e=[1,0,0]:"front"===t&&(e=[0,0,1]),m.fromArray(e).setLength(f.length()).add(g),o.setEye(m.toArray())}},b=o.getInteractors().toArray(),y=new rt(o);i=[];var w=!1;this.addLabelComboBox(i,st("editor.orthographic"),function(){return w},function(t,e){w=e,o.setOrtho(!!e),e?(o.getMoveMode=u,o.setInteractors([y]),v(w)):(o.getMoveMode=p,o.setInteractors(b.slice(0))),o.setRotatable(!e),o.setResettable(!e),o.setWalkable(!e),o.setEditHelperDisabled(!!e)},[!1,"top","right","front"],[st("editor.none"),st("editor.viewtype.top"),st("editor.viewtype.right"),st("editor.viewtype.front")]),this.addOneRow(i);var I=o.getPostProcessingModule("Dof"),D=[],S=void 0,C=function(){S!==I.enable&&(I.enable?D.forEach(function(t,i){t.index=e.getRows().indexOf(P)+i+1,e.addRow(t.items,t.widths,t.height,t)}):e.removeRows(D),S=I.enable)};i=[],this.addLabelCheckBox(i,st("editor.dof"),function(t){return I.enable},function(t,i){o.enablePostProcessing("Dof",i),i&&!I.image&&ht.Default.xhrLoad("assets/Depth.png",function(){I.image="assets/Depth.png",e.updateProperties()}),o.iv(),e.updateProperties()});var P=this.addOneRow(i);i=[],this.addLabelImage(i,st("editor.dof.image"),function(t){return I.image},function(t,i){I.image=i,e.updateProperties()}),D.push(this.addOneRow(i)),i=[],this.addLabelRange(i,st("editor.dof.aperture"),function(t){return parseFloat(I.aperture)},function(t,i){I.aperture=i,e.updateProperties()},0,1,.001,"number"),D.push(this.addOneRow(i)),this.addUpdateHandler(function(){h(),C()})},e}(U),dt=hteditor.getString,lt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"data",!1))}return m(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addBasicProperties(),this.addWireframeProperties(),this.addTransformProperties()},e.prototype.addBasicProperties=function(){var t=this;this.addTitle(dt("editor.titlebasic"));var e=[];this.addLabelInput(e,dt("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(e,dt("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelURL(e,dt("editor.navigate"),function(t){return t.a("navigate")||""},function(t,e){t.a("navigate",e)},function(t,e){var i=e.view.draggingData;return i&&("scene"===i.fileType||"display"===i.fileType)}),this.addLabelInput(e,dt("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelComboBoxURL(e,dt("editor.type"),function(t){return t.s("shape3d")},function(e,i){e.s("shape3d",i),t.editor.updateInspector()},["","billboard","plane","cone","cylinder","roundRect","sphere","torus","triangle"],void 0,void 0,function(t,e){return!!e.view.draggingData&&"model"===e.view.draggingData.fileType}),this.addImage(e,function(t){return t.s("shape3d")},void 0,function(t){return hteditor.isJSON(t)?t.substr(0,t.length-5)+".png":null},function(t){return hteditor.isJSON(t.rawIcon)}),this.addOneRow(e),e=[],this.addLabelCheckBox(e,dt("editor.selectable"),function(t){return t.s("3d.selectable")},function(t,e){t.s("2d.selectable",e),t.s("3d.selectable",e)}),this.addLabelCheckBox(e,dt("editor.movable"),function(t){return t.s("3d.movable")},function(t,e){t.s("2d.movable",e),t.s("3d.movable",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,dt("editor.editable"),function(t){return t.s("3d.editable")},function(t,e){t.s("2d.editable",e),t.s("3d.editable",e)}),this.addLabelCheckBox(e,dt("editor.visible"),function(t){return t.s("3d.visible")},function(t,e){t.s("2d.visible",e),t.s("3d.visible",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,dt("editor.interactive"),function(t){return t.s("interactive")},function(t,e){return t.s("interactive",e)}),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,dt("editor.envmap"),function(t){return t.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,dt("editor.brightness"),function(t){return t.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),
this.addRow(e,[this.indent,.1]),e=[],this.addLabelObject(e,dt("editor.polygonoffset"),function(t){return t.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(e,[this.indent,.1])},e.prototype.addTransformProperties=function(){this.addTitle(dt("editor.titletransform"));var t=[];t.push(dt("editor.position")),this.addButton(t,null,dt("editor.reset"),"editor.resetsize.state",function(t){t instanceof ht.Node&&t.p3(0,0,0)}),this.addLabelInput(t,"X",hteditor.getter("p","x"),hteditor.setter("p","x"),"int",1),this.addLabelInput(t,"Y",hteditor.getter("p","elevation"),hteditor.setter("p","elevation"),"int",1),this.addLabelInput(t,"Z",hteditor.getter("p","y"),hteditor.setter("p","y"),"int",1),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push(dt("editor.rotation")),this.addButton(t,null,dt("editor.reset"),"editor.resetsize.state",function(t){t instanceof ht.Node&&t.r3(0,0,0)}),this.addLabelInput(t,"X",function(t){return Math.round(180/Math.PI*t.getRotationX())},function(t,e){t instanceof ht.Node&&t.setRotationX(e*Math.PI/180)},"int",1),this.addLabelInput(t,"Y",function(t){return Math.round(180/Math.PI*t.getRotationY())},function(t,e){t instanceof ht.Node&&t.setRotationY(e*Math.PI/180)},"int",1),this.addLabelInput(t,"Z",function(t){return Math.round(180/Math.PI*t.getRotationZ())},function(t,e){t instanceof ht.Node&&t.setRotationZ(e*Math.PI/180)},"int",1),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push(dt("editor.size")),this.addButton(t,null,dt("editor.reset"),"editor.resetsize.state",function(t){t instanceof ht.Node&&t.s3(-1,-1,-1)}),this.addLabelInput(t,"X",hteditor.getter("p","width"),hteditor.setter("p","width"),"int",1),this.addLabelInput(t,"Y",hteditor.getter("p","tall"),hteditor.setter("p","tall"),"int",1),this.addLabelInput(t,"Z",hteditor.getter("p","height"),hteditor.setter("p","height"),"int",1),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push(dt("editor.anchor")),this.addButton(t,null,dt("editor.reset"),"editor.resetsize.state",function(t){t instanceof ht.Node&&t.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(t,"X",function(t){return parseFloat(t.getAnchorX().toFixed(4))},function(t,e){t instanceof ht.Node&&t.setAnchor3d(parseFloat(e),t.getAnchorElevation(),t.getAnchorY(),!0)},"number",1e-4),this.addLabelInput(t,"Y",function(t){return parseFloat(t.getAnchorElevation().toFixed(4))},function(t,e){t instanceof ht.Node&&t.setAnchor3d(t.getAnchorX(),parseFloat(e),t.getAnchorY(),!0)},"number",1e-4),this.addLabelInput(t,"Z",function(t){return parseFloat(t.getAnchorY().toFixed(4))},function(t,e){t instanceof ht.Node&&t.setAnchor3d(t.getAnchorX(),t.getAnchorElevation(),parseFloat(e),!0)},"number",1e-4),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push(dt("editor.scale")),this.addButton(t,null,dt("editor.reset"),"editor.resetsize.state",function(t){t instanceof ht.Node&&t.setScale3d(1,1,1)}),this.addLabelInput(t,"X",function(t){return parseFloat(t.getScaleX().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setScaleX(parseFloat(e))},"number",.01),this.addLabelInput(t,"Y",function(t){return parseFloat(t.getScaleTall().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setScaleTall(parseFloat(e))},"number",.01),this.addLabelInput(t,"Z",function(t){return parseFloat(t.getScaleY().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setScaleY(parseFloat(e))},"number",.01),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1])},e.prototype.addWireframeProperties=function(){this.addTitle(dt("editor.titlewireframe"));var t=[];this.addLabelComboBox(t,dt("editor.visible"),hteditor.getter("s","wf.visible"),function(t,e){t.s("wf.visible",e)},[!1,!0,"selected"]),this.addLabelCheckBox(t,dt("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(t,[this.indent,.1,this.indent2,.1]),t=[],this.addLabelColor(t,dt("editor.color"),hteditor.getter("s","wf.color"),function(t,e){return t.s("wf.color",e)}),this.addRow(t,[this.indent,.1])},e}(U),ct=hteditor.getString,pt=["all","front","back","left","right","top","bottom"],ut=function(t,e,i){return function(o){var n=o.s(t+"."+e);return i&&void 0===n?o.s("all."+e):n}},gt=function(t){return function(e){var i=e.s(t);return i||(i=e.s("all.uv.scale")),i?i[0]:1}},ft=function(t){return function(e,i){var o=e.s(t);o||(o=e.s("all.uv.scale")),e.s(t,[i,o?o[1]:1])}},mt=function(t){return function(e){var i=e.s(t);return i||(i=e.s("all.uv.scale")),i?i[1]:1}},vt=function(t){return function(e,i){var o=e.s(t);o||(o=e.s("all.uv.scale")),e.s(t,[o?o[0]:1,i])}},bt=function(t){return function(e){e.s(t,null)}},yt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Cube"))}return m(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addCubeProperties()},e.prototype.addCubeProperties=function(){var t=void 0,e=void 0,i=0,o=new ht.widget.TabView;e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var s=pt[n]+".image";t=[],this.addLabelImage(t,ct("editor.face."+pt[n]),ut(pt[n],"image"),hteditor.setter("s",s)),e.addRow(t,[this.indent,.1,20])}r(o,ct("editor.image"),e,!0),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var a=pt[n]+".uv.scale";t=[],this.addLabel(t,ct("editor.face."+pt[n])),this.addButton(t,null,ct("editor.reset"),"editor.resetsize.state",bt(a)),this.addLabelInput(t,"U",gt(a),ft(a),"number",1),this.addLabelInput(t,"V",mt(a),vt(a),"number",1),e.addRow(t,[this.indent-20-8,20,20,.1,20,.1])}r(o,ct("editor.repeat"),e,!0),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var d=pt[n]+".color";t=[],this.addLabelColor(t,ct("editor.face."+pt[n]),ut(pt[n],"color"),hteditor.setter("s",d)),e.addRow(t,[this.indent,.1])}r(o,ct("editor.color"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var h=pt[n]+".transparent";t=[],this.addLabelCheckBox(t,ct("editor.face."+pt[n]),ut(pt[n],"transparent"),hteditor.setter("s",h)),e.addRow(t,[this.indent,.1])}r(o,ct("editor.transparent"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var l=pt[n]+".visible";t=[],this.addLabelCheckBox(t,ct("editor.face."+pt[n]),ut(pt[n],"visible",!0),hteditor.setter("s",l)),e.addRow(t,[this.indent,.1])}r(o,ct("editor.visible"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var c=pt[n]+".reverse.color";t=[],this.addLabelColor(t,ct("editor.face."+pt[n]),ut(pt[n],"reverse.color"),hteditor.setter("s",c)),e.addRow(t,[this.indent,.1])}r(o,ct("editor.reversecolor"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var p=pt[n]+".reverse.flip";t=[],this.addLabelCheckBox(t,ct("editor.face."+pt[n]),ut(pt[n],"reverse.flip",!0),hteditor.setter("s",p)),e.addRow(t,[this.indent,.1])}r(o,ct("editor.reverseflip"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var n=0;n<pt.length;n++){var u=pt[n]+".reverse.cull";t=[],this.addLabelCheckBox(t,ct("editor.face."+pt[n]),ut(pt[n],"reverse.cull",!0),hteditor.setter("s",u)),e.addRow(t,[this.indent,.1])}r(o,ct("editor.reversecull"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight());var g=o.getTabHeight()+i;t=[],t.push(o),this.addRow(t,[.1],g)},e}(lt),wt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Cone"))}return m(e,t),e}(lt),It=hteditor.getString,Dt=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],St=["shape3d","shape3d.top","shape3d.bottom"],Ct=function(t){return function(e){var i=e.s(t);return i?i[0]:1}},Pt=function(t){return function(e,i){var o=e.s(t);e.s(t,[i,o?o[1]:1])}},Tt=function(t){return function(e){var i=e.s(t);return i?i[1]:1}},Lt=function(t){return function(e,i){var o=e.s(t);e.s(t,[o?o[0]:1,i])}},xt=function(t){return function(e){e.s(t,null)}},Rt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Shape3d"))}return m(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},e.prototype.getCurrentPoint=function(t){return this.editor.currentPoint?this.editor.currentPoint[t]:0},e.prototype.setCurrentPoint=function(t,e){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(t,e)},e.prototype.addTopBodyBottomProperties=function(){var t=void 0,e=void 0,i=0,o=new ht.widget.TabView,n=this.faces;e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var a=n[s]+".image";t=[],this.addLabelImage(t,It("editor.face."+n[s]),hteditor.getter("s",a),hteditor.setter("s",a)),e.addRow(t,[this.indent,.1,20])}r(o,It("editor.image"),e,!0),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var d=n[s]+".uv.scale";t=[],this.addLabel(t,It("editor.face."+n[s])),this.addButton(t,null,It("editor.reset"),"editor.resetsize.state",xt(d)),this.addLabelInput(t,"U",Ct(d),Pt(d),"number",1),this.addLabelInput(t,"V",Tt(d),Lt(d),"number",1),e.addRow(t,[this.indent-20-8,20,20,.1,20,.1])}r(o,It("editor.repeat"),e,!0),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var h=n[s]+".color";t=[],this.addLabelColor(t,It("editor.face."+n[s]),hteditor.getter("s",h),hteditor.setter("s",h)),e.addRow(t,[this.indent,.1,20])}r(o,It("editor.color"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var l=n[s]+".visible";t=[],this.addLabelCheckBox(t,It("editor.face."+n[s]),hteditor.getter("s",l),hteditor.setter("s",l)),e.addRow(t,[this.indent,.1,20])}r(o,It("editor.visible"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight()),e=new ht.widget.FormPane,t=[],this.addLabelColor(t,It("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),e.addRow(t,[this.indent,.1]),t=[],this.addLabelCheckBox(t,It("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),e.addRow(t,[this.indent,.1]),t=[],this.addLabelCheckBox(t,It("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),e.addRow(t,[this.indent,.1]),r(o,It("editor.reverse"),e),e.validateImpl(),i=Math.max(i,e.getScrollHeight());var c=o.getTabHeight()+i;t=[],t.push(o),this.addRow(t,[.1],c)},e.prototype.addEffectProperties=function(){this.addTitle(It("editor.titleeffect"));var t=[];this.addLabelCheckBox(t,It("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(t,[this.indent,.1]),t=[],this.addLabelColor(t,It("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(t,[this.indent,.1]),t=[],this.addLabelRange(t,It("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(t,[this.indent,.1]),t=[],this.addLabelRange(t,It("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(t,[this.indent,.1]),this.simple||(t=[],this.addLabelRange(t,It("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(t,[this.indent,.1]),t=[],this.addLabelRange(t,It("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(t,[this.indent,.1]))},e.prototype.addExtraProperties=function(t){},f(e,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?St:Dt}}]),e}(lt),kt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Cylinder"))}return m(e,t),e}(Rt),Et=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"RoundRect"))}return m(e,t),e}(lt),_t=["shape3d","shape3d.from","shape3d.to"],Mt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Sphere"))}return m(e,t),f(e,[{key:"faces",get:function(){return _t}}]),e}(Rt),Bt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Torus"))}return m(e,t),e}(lt),Vt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Triangle"))}return m(e,t),e}(lt),Ft=hteditor.getString,Nt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Model"))}return m(e,t),e.prototype.addBasicProperties=function(){t.prototype.addBasicProperties.call(this);var e=[];e=[],this.addLabelCheckBox(e,Ft("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelColor(e,Ft("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelColor(e,Ft("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,Ft("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelCheckBox(e,Ft("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(e,[this.indent,.1])},e}(lt),zt=hteditor.getString,Ot=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Billboard"))}return m(e,t),e.prototype.addBasicProperties=function(){var e=this;t.prototype.addBasicProperties.call(this),this.addTitle(zt("editor.titlepanel"));var i=[];this.addLabelImage(i,zt("editor.image"),function(t){return t.s("shape3d.image")},function(t,e){t.s("shape3d.image",e)}),this.addOneRow(i),i=[],this.addLabelInput(i,zt("editor.texturescale"),function(t){return t.s("shape3d.texture.scale")||1},hteditor.setter("s","shape3d.texture.scale"),"number");var o=i[i.length-1];this.addOneRow(i),i=[],this.addLabelCheckBox(i,zt("editor.alwaysontop"),hteditor.getter("s","shape3d.alwaysOnTop"),hteditor.setter("s","shape3d.alwaysOnTop")),this.addLabelCheckBox(i,zt("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelCheckBox(i,zt("editor.autorotate"),hteditor.getter("s","shape3d.autorotate"),hteditor.setter("s","shape3d.autorotate"));var n=i[i.length-1];this.addLabelCheckBox(i,zt("editor.cache"),hteditor.getter("s","shape3d.image.cache"),function(t,i){t.s("shape3d.image.cache",i),i&&e.editor.scene.invalidateShape3dCachedImage(t),o.setDisabled(i)}),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelCheckBox(i,zt("editor.fitsize"),function(t){return!!t.s("shape3d.fixSizeOnScreen")},function(t,e){t.s("shape3d.fixSizeOnScreen",!!e&&[-1,-1]),e&&t.s("shape3d.autorotate",!0),n.setDisabled(e),r.setDisabled(e)}),this.addLabelCheckBox(i,zt("editor.dynamic"),hteditor.getter("s","shape3d.vector.dynamic"),hteditor.setter("s","shape3d.vector.dynamic"));var r=i[i.length-1];this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelColor(i,zt("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(i,[this.indent,.1]),i=[],this.addLabelColor(i,zt("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(i,[this.indent,.1]),i=[],this.addLabelCheckBox(i,zt("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(i,zt("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(i,[this.indent,.1,this.indent2,.1])},e}(lt),Ht=hteditor.getString,At=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Wall"))}return m(e,t),e.prototype.addBasicProperties=function(){t.prototype.addBasicProperties.call(this);var e=[];this.addLabelCheckBox(e,Ht("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(e,[this.indent,.1])},e.prototype.addTransformProperties=function(){t.prototype.addTransformProperties.call(this);var e=[];this.addLabelRange(e,Ht("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(e,Ht("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(e,Ht("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1,30,.1,30,.1])},e}(yt),Wt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Floor"))}return m(e,t),e}(kt),jt=hteditor.getString,qt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Pipeline"))}return m(e,t),e.prototype.addTransformProperties=function(){t.prototype.addTransformProperties.call(this);var e=[];this.addLabelRange(e,jt("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(e,jt("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(e,jt("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1,30,.1,30,.1])},e.prototype.addExtraProperties=function(e){t.prototype.addExtraProperties.call(this);var i=[];this.addLabelInput(i,jt("editor.startangle"),function(t){return Math.round(180/Math.PI*t.s("shape3d.start.angle"))},function(t,e){t.s("shape3d.start.angle",e*Math.PI/180)},"int",1),e.addRow(i,[this.indent,.1]),i=[],this.addLabelInput(i,jt("editor.sweepangle"),function(t){return Math.round(180/Math.PI*t.s("shape3d.sweep.angle"))},function(t,e){t.s("shape3d.sweep.angle",e*Math.PI/180)},"int",1),e.addRow(i,[this.indent,.1])},f(e,[{key:"simple",get:function(){return!0}}]),e}(Rt),Ut=hteditor.getString,Gt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Polyline"))}return m(e,t),e.prototype.addTransformProperties=function(){var e=this;t.prototype.addTransformProperties.call(this);var i=[];this.addLabelRange(i,Ut("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(i,Ut("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(i,Ut("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(i,[this.indent,.1,30,.1,30,.1]),i=[],i.push(Ut("editor.point")),this.addButton(i,null,Ut("editor.reset"),"editor.resetsize.state",function(t){e.setCurrentPoint("e",0)}),this.addLabelInput(i,"X",function(t){return e.getCurrentPoint("x")},function(t,i){e.setCurrentPoint("x",i)},"int",1),this.addLabelInput(i,"Y",function(t){return e.getCurrentPoint("e")},function(t,i){e.setCurrentPoint("e",i)},"int",1),this.addLabelInput(i,"Z",function(t){return e.getCurrentPoint("y")},function(t,i){e.setCurrentPoint("y",i)},"int",1),this.addRow(i,[this.indent-40-8,20,20,.1,20,.1,20,.1])},f(e,[{key:"simple",get:function(){return!0}}]),e}(Rt),Jt=function(t){function e(i){return g(this,e),v(this,t.call(this,i,"Edge"))}return m(e,t),e}(lt),Xt=hteditor.getString,Zt=function(t){function e(i){g(this,e);var o=v(this,t.call(this));o.editor=i;var n=[];return n.push({label:Xt("editor.ok"),action:function(){o.ok()}}),n.push({label:Xt("editor.cancel"),action:function(){o.hide()}}),o.dm=new ht.DataModel,o.node=new ht.Node,o.node.setAnchor3d(.5,0,.5),o.dm.add(o.node),o.g3d=new ht.graph3d.Graph3dView(o.dm),o.g3d.setGridVisible(!0),o.formPane=o.createFromPane(),o.splitView=new ht.widget.SplitView(o.g3d,o.formPane,"h",.55),o.setConfig({title:Xt("editor.objsetting"),closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:o.splitView,buttons:n,buttonsAlign:"right"}),o.setModal(!1),o}return m(e,t),e.prototype.ok=function(){var t=this,e=this.formPane.v("url");if(e){this.json||(this.json={modelType:"obj"}),this.json.obj=this.formPane.v("obj"),this.json.mtl=this.formPane.v("mtl"),this.json.image=this.formPane.v("imageURL"),this.json.prefix=this.formPane.v("prefix"),this.associateObjectTextField&&(this.json["hx.associateObject"]=this.associateObjectTextField.getValue()||void 0);var i={path:e,content:ht.Default.stringify(this.json)};this.editor.request("upload",i,function(o){t.node.s("shape3d",e),setTimeout(function(){i={path:e.substr(0,e.length-5)+".png",content:t.g3d.toDataURL(t.dm.getBackground())},t.editor.request("upload",i,function(e){t.hide()})},500)})}},e.prototype.open=function(t,e){this.url=t,this.json=e,this.node.s("shape3d",t),this.node.p3(0,0,0),this.g3d.reset(),this.update(),this.isShowing()||this.show()},e.prototype.update=function(){var t=this.json;this.url?(this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",this.url)):(this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url",this.editor.models.currentDir+"/***.json"));var e=ht.Default.getShape3dModel(this.url);if(e&&e.rawS3){var i=e.rawS3[0],o=e.rawS3[1],n=e.rawS3[2],r=Math.max(o,i/(this.g3d.getAspect()||1)),s=r/2/Math.tan(this.g3d.getFovy()/2);s=2*Math.max(n/2,s),this.g3d.setEye(0,o/2,s),this.g3d.setCenter(0,o/2,0),this.g3d.setNear(Math.min(10,s/4)),this.g3d.setFar(Math.max(1e4,4*s)),t=this.json=ht.Default.parse(ht.Default.stringify(e.json))}t||(t={obj:"assets/objs/***.obj",mtl:"assets/objs/***.mtl",imageURL:"",prefix:"",image:null}),this.formPane.v("obj",t.obj||""),this.formPane.v("mtl",t.mtl||""),this.formPane.v("imageURL",t.image||""),this.formPane.v("prefix",t.prefix||""),this.formPane.getItemById("image").element.setIcon(t.image)},e.prototype.createFromPane=function(){var t=this,e=new ht.widget.FormPane;e.addRow([{element:Xt("editor.url")},{id:"url",textField:{}}],[60,.1]),e.addRow([{element:"obj"},{id:"obj",textField:{}}],[60,.1]),e.addRow([{element:"mtl"},{id:"mtl",textField:{}}],[60,.1]),e.addRow([{element:Xt("editor.imageprefix")},{id:"prefix",textField:{}}],[60,.1]),e.addRow([{element:Xt("editor.image")},{id:"imageURL",textField:{}}],[60,.1]),e.addRow([{id:"image",image:{}}],[.1],70);var i=e.getViewById("imageURL").getElement();return i.onblur=function(e){t.formPane.getItemById("image").element.setIcon(i.value)},i.onkeydown=function(e){ht.Default.isEnter(e)&&t.formPane.getItemById("image").element.setIcon(i.value)},e},e}(ht.widget.Dialog),Yt=hteditor.getString,Kt=function(){function d(t){var e=this;g(this,d),this.params=t,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.parentDOM=t.parentDOM||window;var i=ht.Default.getClass(hteditor.config.serviceClass||b);this.service=new i(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(t,i){for(var o in e.modelDialogs){var n=e.modelDialogs[o];t===n.url&&n.isShowing()&&n.update&&n.update()}e.inspector&&e.inspector.updateProperties()},this.serializer=new ht.JSONSerializer,this.serializer.isSerializable=function(t){return e.scene.sm().contains(t)}}return d.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},d.prototype.removeEventListener=function(t,e){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},d.prototype.fireEvent=function(t,e){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},d.prototype.handleServiceEvent=function(r){if("connected"===r.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===r.type){var s=r.path;n(s)&&(this.scene.invalidateAll(),this.gv.invalidateAll()),t(s)?this.requestScenes():e(s)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):i(s)?this.requestSymbols():o(s)&&this.requestAssets()}else"download"===r.type&&this.downloadFile(r.path)},d.prototype.downloadFile=function(t){try{var e=document.createElement("iframe");e.src=t,e.style.display="none",document.body.appendChild(e)}catch(t){}},d.prototype.beginTransaction=function(){this.dm.beginTransaction()},d.prototype.endTransaction=function(){this.dm.endTransaction()},d.prototype.toggleGridEnabled=function(){this.gridVisible=!this.gridVisible},d.prototype.init=function(){var t=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new F(this),this.rulerView=new V(this.gv),this.scene=new M(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.sceneInspector=new at(this),this.dataInspector=new lt(this),this.cubeInspector=new yt(this),this.coneInspector=new wt(this),this.cylinderInspector=new kt(this),this.roundRectInspector=new Et(this),this.sphereInspector=new Mt(this),this.torusInspector=new Bt(this),this.triangleInspector=new Vt(this),this.modelInspector=new Nt(this),this.billboardInspector=new Ot(this),this.wallInspector=new At(this),this.floorInspector=new Wt(this),this.pipelineInspector=new qt(this),this.polylineInspector=new Gt(this),this.edgeInspector=new Jt(this),this.mainToolbar=new k(this),this.rightToolbar=new _(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){t.topBorderPane.setRightWidth(t.rightToolbar.getSumWidth())},this.setInteractionState("edit"),this.mainTabView=new ht.widget.TabView,this.scenes=new w(this),this.models=new I(this),this.symbols=new D(this),this.assets=new S(this),this.leftTopTabView=new ht.widget.TabView,r(this.leftTopTabView,Yt("editor.scenes"),this.scenes,!0),r(this.leftTopTabView,Yt("editor.models"),this.models),r(this.leftTopTabView,Yt("editor.symbols"),this.symbols),r(this.leftTopTabView,Yt("editor.assets"),this.assets),this.treeView=new H(this),this.jsonView=new W(this),this.rightBottomTabView=new ht.widget.TabView,r(this.rightBottomTabView,Yt("editor.list"),this.treeView,!0),r(this.rightBottomTabView,Yt("editor.data"),this.jsonView);var e=this.rightBottomTabView.getTabModel().sm();e.ms(function(){var i=e.ld();t.jsonView.visible=(i?i.getView():null)===t.jsonView}),this.alignPane=new q(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.parentDOM),this.parentDOM.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.parentDOM),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.reset(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var i=this.params.open||a("hteditor")||hteditor.config.open;i&&(hteditor.isJSON(i)?this._pendingOpenJSON=i:"newscene"===i&&this.newScene())},d.prototype.initSID=function(){var t=window.location.href.match("sid=([0-9a-z-]*)");t&&(this.sid=t[1])},d.prototype.handleDataModelPropertyChange=function(t){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},d.prototype.handleScenelPropertyChange=function(t){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},d.prototype.handleDataModelChange=function(t){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},d.prototype.handleDataPropertyChange=function(t){var e=t.data;if("parent"===t.property&&e instanceof ht.Node&&!ht.Default.isIsolating()){var i=e.getParent();(!i||i instanceof ht.Node&&!(i instanceof ht.Block))&&e.setHost(i)}this.inspector&&!this.inspector.global&&this.inspector.data===e&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},d.prototype.handleSelectionChange=function(){this.updateInspector()},d.prototype.handleInteractor=function(t){"selectPoint"===t.kind&&(this.currentPoint=void 0===t.x?null:{x:t.x,y:t.y,e:t.e},this.updateInspector())},d.prototype.updateInspector=function(){this.inspector=null;var t=this.ld;if(t){var e=t.s("shape3d");t instanceof ht.Polyline?this.inspector=this.polylineInspector:t instanceof ht.Shape?"cylinder"===e?this.inspector=this.pipelineInspector:t.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:t instanceof ht.Node?e?hteditor.isJSON(e)?this.inspector=this.modelInspector:"billboard"===e||"plane"===e?this.inspector=this.billboardInspector:"cube"===e?this.inspector=this.cubeInspector:"cone"===e?this.inspector=this.coneInspector:"cylinder"===e?this.inspector=this.cylinderInspector:"roundRect"===e?this.inspector=this.roundRectInspector:"sphere"===e?this.inspector=this.sphereInspector:"torus"===e?this.inspector=this.torusInspector:"triangle"===e&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:t instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=t,this.inspector.updateProperties()),this.rightTopBorderPane.setCenterView(this.inspector)},d.prototype.reset=function(t){t||(this.url=null),this.dm.disableHistoryManager(),this.scene.setCenter([0,0,0]),this.scene.setEye([0,300,1e3]),this.scene.enablePostProcessing("Bloom",!1),this.scene.enablePostProcessing("Dof",!1),this.gridVisible=!0,this.dm.setName(void 0),this.dm.setBackground(void 0),this.dm.setHierarchicalRendering(!0),this.dm.setLayers(void 0),this.dm.setAttrObject(void 0),this.dm.setEnvmap(void 0),this.dm.clear(),this.editInteractor.setStyle("gridBlockSize",50),this.editInteractor.setStyle("gridThickLinesEvery",hteditor.config.displayGridThickLinesEvery),this.editInteractor.setStyle("gridThickColor",hteditor.config.displayGridThickColor),this.editInteractor.setStyle("gridLightColor",hteditor.config.displayGridLightColor),this.editInteractor.setStyle("gridAngle",hteditor.config.displayGridAngle),this.editInteractor.setStyle("gridRotation",hteditor.config.displayGridRotation),this.editInteractor.setStyle("gridZoomThreshold",.02),this.dm.enableHistoryManager(),this.dm.clearHistoryManager()},d.prototype.getModelDialog=function(t){var e=this.modelDialogs[t];if(!e){var i=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[t]:null;i||(i=Zt),e=this.modelDialogs[t]=new i(this)}return e},d.prototype.open=function(t,e){var i=this;if(ht.Default.isString(t)&&(t=this.getFileNode(t)),t&&!t._changedId){var o=t.url;"scene"===t.fileType?this.newScene(o):"model"===t.fileType&&ht.Default.xhrLoad(o,function(t){t=ht.Default.parse(t),i.getModelDialog(t.modelType).open(o,t)})}},d.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},
d.prototype.newScene=function(t){t?(this.url=t,this.reload()):this.reset()},d.prototype.reload=function(){var t=this,e=this.url;e&&(this.reset(!0),this.dm.disableHistoryManager(),this.scene.deserialize(e,function(e,i){t.gv.fitContent(!0);var o=e.scene;t.scene.setEye(o.eye),t.scene.setCenter(o.center),t.scene.setFar(o.far),t.scene.setNear(o.near),t.gridVisible=!!o.gridVisible,t.scene.setGridColor(o.gridColor),t.scene.setGridGap(o.gridGap),t.scene.setGridSize(o.gridSize),t.scene.setEditHelperDisabled(!!o.editHelperDisabled),t.rightToolbar.iv(),t.dm.enableHistoryManager(),t.dm.clearHistoryManager()}))},d.prototype.save=function(){var t=this;if(this.url)this.saveImpl(this.url);else{var e=this.scenes.currentDir,i=Yt("editor.inputnewscenename"),o=function(i,o){if("ok"===o){var n=hteditor.isJSON(i)?hteditor.trimExtension(i):i,r=e+"/"+n+".json",s=!1;if(t.scenes.dataModel.each(function(t){t.url===r&&(s=!0)}),s){var a=[{label:Yt("editor.ok"),action:function(){d.hide()}}],d=new ht.widget.Dialog({title:Yt("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+r+"</p>",buttons:a});d.show()}else t.saveImpl(r)}},n={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",n),n.name?o(n.name,"ok"):hteditor.getInput(i,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},o)}},d.prototype.saveImpl=function(t){var e=this;if(t){this.url=t;var i={url:t,scene:this.scene};if(this.fireEvent("sceneSaving",i),i.preventDefault)return!1;i={path:i.url,content:this.serialize()},this.request("upload",i,function(o){!0===o&&(e.fireEvent("sceneSaved",i),i={path:t.substr(0,t.length-5)+".png",content:e.scene.toImage(e.dm.getBackground())},e.request("upload",i))})}},d.prototype.preview=function(){var t=this.dm.a("previewURL")||"scene.html";this.url&&(t+=-1===t.indexOf("?")?"?":"&",t+="tag="+encodeURI(this.url));var e={url:t};this.fireEvent("sceneViewPreviewing",e),window.open(e.url,e.url),e={path:"previews/scene.json",content:this.serialize()},this.request("upload",e,function(t){})},d.prototype.deserialize=function(t){var e=this;this.scene.deserialize(t,function(t,i,o){var n=t.scene;n&&(n.eye&&e.scene.setEye(n.eye),n.center&&e.scene.setCenter(n.center),n.near&&e.scene.setNear(n.near),n.far&&e.scene.setFar(n.far),n.background&&e.dm.setBackground(n.background),n.gridSize&&e.scene.setGridSize(n.gridSize),n.gridGap&&e.scene.setGridGap(n.gridGap),n.gridColor&&e.scene.setGridColor(n.gridColor))})},d.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},d.prototype.toJSON=function(){var t=this.dm.toJSON();return t.scene={eye:this.scene.getEye(),center:this.scene.getCenter(),near:this.scene.getNear(),far:this.scene.getFar(),background:this.dm.getBackground(),gridVisible:this.gridVisible,gridSize:this.scene.getGridSize(),gridGap:this.scene.getGridGap(),gridColor:this.scene.getGridColor(),editHelperDisabled:this.scene.isEditHelperDisabled()},t},d.prototype.getInteractionState=function(){return this._interactionState},d.prototype.setInteractionState=function(t,e){var i=this;if(this._interactionState!==t){this._interactionState=t,this.pointsEditingMode=!1;var o=[];this.gv.getInteractors().each(function(e){e.keep?e.interactiveDisabled="edit"!==t:o.push(e)}),o.forEach(function(t){t.tearDown(),i.gv.getInteractors().remove(t)}),"edit"!==t&&(e.setUp(),this.gv.getInteractors().add(e)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},d.prototype.request=function(t,e,i,o){var n=this;i=i||p,o?setTimeout(function(){n.service.request(t,e,i)},o):this.service.request(t,e,i)},d.prototype.requestScenes=function(){var e=this;this._requestingScenes||(this.request("explore","/scenes",function(i){e._requestingScenes=!1,e.scenes.parse(i),e._pendingOpenJSON&&t(e._pendingOpenJSON)&&(e.scenes.dataModel.getDataById(e._pendingOpenJSON)?(e.open(e._pendingOpenJSON),e.selectFileNode(e._pendingOpenJSON)):c.config.newIfFailToOpen&&(e.newScene(),e.url=e._pendingOpenJSON,e.save()),delete e._pendingOpenJSON)},hteditor.config.requestDelay),this._requestingScenes=!0)},d.prototype.requestSymbols=function(){var t=this;this._requestingSymbols||(this.request("explore","/symbols",function(e){t._requestingSymbols=!1,t.symbols.parse(e)},hteditor.config.requestDelay),this._requestingSymbols=!0)},d.prototype.requestModels=function(){var t=this;this._requestingModels||(this.request("explore","/models",function(e){t._requestingModels=!1,t.models.parse(e)},hteditor.config.requestDelay),this._requestingModels=!0)},d.prototype.requestAssets=function(){var t=this;this._requestingAssets||(this.request("explore","/assets",function(e){t._requestingAssets=!1,t.assets.parse(e)},hteditor.config.requestDelay),this._requestingAssets=!0)},d.prototype.requestBase64=function(t,e){this.request("source",{url:t,encoding:"base64",prefix:"data:;base64,"},e)},d.prototype.copy=function(){this.ld&&(this.serializer.dm=this.scene.dm(),this._cloneJSON=this.serializer.serialize())},d.prototype.paste=function(){if(this._cloneJSON){var t=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(t)}},d.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},d.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},d.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},d.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},d.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},d.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},d.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},d.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},d.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},d.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},d.prototype.handleKeydown=function(t){var e=t.keyCode,i=ht.Default.isCtrlDown(t);if(i&&83===e&&t.preventDefault(),i&&83===e)return void this.save();if(!ht.Default.isInput(t.target)){if(t.preventDefault(),ht.Default.isEsc(t))for(var o=0;o<this.menus.length;o++)if(this.menus[o].isShowing())return void this.menus[o].hide();var n=ht.Default.isShiftDown(t);if(80===e)this.preview();else if(90===e)if(i)n?this.redo():this.undo();else{var r=this.dm.sm().getSelection();0===r.length&&(r=null),this.zoomToFit(r)}else if(71===e){if(i){if(n){var s=this.dm.sm().ld();if(!s||!s.s("__group__"))return;this.beginTransaction();var a=s.getChildren().toArray();return a.forEach(function(t){t.setParent(null),t.setHost(null)}),this.dm.remove(s),this.dm.sm().ss(a),void this.endTransaction()}if(0===this.dm.sm().size())return;var d=this.scene.getBoundingBox(),h=d.min,l=d.max,c=l[0]-h[0],p=l[2]-h[2],u=l[1]-h[1];this.beginTransaction();var g=new ht.Node;g.s3(c,u,p),g.p3(h[0]+.5*c,h[1]+.5*u,h[2]+.5*p),g.s({shape3d:"box","shape3d.transparent":!0,"shape3d.color":"rgba(0, 0, 0, 0)","shape3d.reverse.cull":!0,__group__:!0}),this.dm.add(g);var r=this.dm.sm().getSelection();r.forEach(function(t){t.setParent(g),t.setHost(g)}),this.dm.sm().ss(g),this.endTransaction()}}else i&&67===e?this.copy():i&&86===e&&this.paste()}},d.prototype.selectFileNode=function(t){for(var e=this,i=this.leftTopTabView.getTabModel().getDatas(),o=0;o<i.size();o++){var n=i.get(o);if(n.getView()instanceof hteditor.Explorer){var r=function(){var i=n.getView(),o=i.dataModel.getDataById(t);if(o)return e.leftTopTabView.getTabModel().sm().ss(n),"dir"===o.fileType?(i.tree.sm().ss(o),setTimeout(function(){i.tree.makeVisible(o)},500)):(i.tree.sm().ss(o.getParent()),i.list.sm().ss(o),setTimeout(function(){i.tree.makeVisible(o.getParent()),i.list.makeVisible(o)},500)),{v:void 0}}();if("object"==typeof r)return r.v}}},d.prototype.dropLocalFileOnDir=function(t,e){for(var i=t.dataTransfer.files,o=0;o<i.length;o++)this.uploadLocalFile(i[o],e.url)},d.prototype.uploadLocalFile=function(t,e){var i=this,o=t.name;s(t,function(t){var n={path:e+"/"+o,content:t};i.request("upload",n)},!0)},d.prototype.zoomToFit=function(t){this.scene.flyTo(t,{animation:!0});var e=this.gv;if(!t)return void e.fitContent(!0);var i;t.each(function(t){i=ht.Default.unionRect(i,e.getDataUIBounds(t))}),ht.Default.grow(i,20,20),e.fitRect(i,!0)},f(d,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this.jsonView.updateURL()}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(t){this.editInteractor.pointsEditingMode=t}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(t){this.editInteractor.setStyle("anchorVisible",t)}},{key:"gridVisible",get:function(){return this.scene.isGridVisible()},set:function(t){this.scene.setGridVisible(t),this.scene.setOriginAxisVisible(t),this.editInteractor.gridEnabled=t}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}}]),d}();return c.version="0.3.1",c.createEditor3d=function(t){if(window.location.host.indexOf("hightopo")>=0){var e="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+e+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}t&&(ht.Default.isString(t)?t={container:t}:t.tagName&&t.appendChild&&(t={container:t})),t=t||{};var i=void 0,o=void 0===t.container?c.config.container:t.container;return null===o?i=null:o?ht.Default.isString(o)?i=document.getElementById(o):o.length?(i=ht.Default.createDiv(),i.style.left=o[0]+"px",i.style.top=o[1]+"px",i.style.width=o[2]+"px",i.style.height=o[3]+"px",document.body.appendChild(i)):i=o:i=document.body,t.parentDOM=i,new Kt(t)},c.config.valueTypes||(c.config.valueTypes={}),c.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},c});